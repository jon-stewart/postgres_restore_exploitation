from contextlib import closing
import psycopg2

from util import database, exec_psql


with database('db'):
    exec_psql([
        """CREATE TABLE dump (t TEXT)""",
        """CREATE FUNCTION poc() RETURNS TRIGGER AS '/tmp/trigger_poc', 'pgtrigger' LANGUAGE 'c' STRICT""",
        """CREATE TRIGGER poc BEFORE INSERT ON dump FOR EACH ROW EXECUTE FUNCTION poc()""",
        """INSERT INTO dump (t) VALUES ('random')"""], db='db')
